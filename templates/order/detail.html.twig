{% extends 'base.html.twig' %}

{% block title %}Objednávka {{ order.number }}{% endblock %}

{% block content %}
    <h1>Objednávka {{ order.number }}</h1>

    <div class="mb-2">
        <div class="d-flex align-items-start">
            {% if order.canBePicked %}
                <a class="btn btn-outline-primary me-2 mb-1" href="{{ path('order_prepare_item', {'id': order.id}) }}">
                    <i class="bi bi-box-seam"></i> Vychystávání
                </a>
            {% endif %}

            {% if order.canStartPacking %}
                <a class="btn btn-outline-primary me-2 mb-1" href="{{ path('order_start_packing', {'id': order.id}) }}">
                    <i class="bi bi-box-fill"></i> Začít balení
                </a>
            {% endif %}

            {% if order.canBeShipped %}
                <a class="btn btn-outline-primary me-2 mb-1" href="{{ path('order_ship', {'id': order.id}) }}">
                    <i class="bi bi-truck"></i> Předáno dopravci
                </a>
            {% endif %}

            {% if order.canPrintLabel %}
                <twig:Label:PrintLabelForm order="{{ order }}" />
            {% endif %}

            {% if order.canMarkAsProblematic %}
                <a class="btn btn-outline-danger me-2 mb-1" href="{{ path('order_mark_has_problem', {'id': order.id}) }}">
                    <i class="bi bi-exclamation-circle"></i> Označit jako problém
                </a>
            {% endif %}
        </div>
    </div>

    <p>
        <twig:Order:StatusBadge status="{{ order.status.value }}" />
    </p>

    <div class="row row-cols-1 row-cols-md-2 g-4">

        <div class="col">
            <div class="card mb-3">
                <div class="card-body">
                    <h3>Doručovací adresa</h3>

                    {{ order.email }} {{ order.phone }}{% if order.email or order.phone %}<br>{% endif %}
                    Dopravce: {{ order.carrier }}<br>
                    {{ order.deliveryAddress.name }}<br>
                    {{ order.deliveryAddress.street }}<br>
                    {{ order.deliveryAddress.city }} {{ order.deliveryAddress.postalCode }}
                </div>
            </div>
        </div>

        <div class="col">
            <div class="card mb-3">
                <div class="card-body">
                    <h3>Detaily objednávky</h3>

                    Uživatel: {{ order.user.email }}<br>
                    Dobírka: {{ order.cashOnDelivery }} Kč<br>
                    Vytvořena: {{ order.orderedAt|date('d.m.Y H:i:s') }}<br>
                    {% if order.expeditionDate %}
                        Expedovat dne: {{ order.expeditionDate|date('d.m.Y') }}<br>
                    {% endif %}
                    Stav: {{ order.status.value }}<br>
                </div>
            </div>
        </div>
    </div>

    <div class="table-responsive shadow-lg">
        <table class="table table-hover mb-0">
            <thead class="table-dark">
            <tr>
                <th scope="col">SKU</th>
                <th scope="col">Název</th>
                <th scope="col">EAN</th>
                <th scope="col">Počet</th>
                <th scope="col">Cena / ks</th>
            </tr>
            </thead>
            <tbody>
                {% for item in order.items %}
                    <tr>
                        <td>
                            {% if item.product %}
                                <a href="{{ path('product_info', {'id': item.product.id}) }}">
                                    {{ item.sku }}
                                </a>
                            {% else %}
                                {{ item.sku }}
                            {% endif %}
                        </td>
                        <td>
                            {% if item.product %}
                                <a href="{{ path('product_info', {'id': item.product.id}) }}">
                                    {{ item.title }}
                                </a>
                            {% else %}
                                {{ item.title }}
                            {% endif %}
                        </td>
                        <td>{{ item.ean }}</td>

                        <td>
                            {{ item.preparedQuantity }} / {{ item.quantity }}
                            {% if item.fullyPrepared %}
                                <span class="badge bg-success">OK</span>
                            {% endif %}
                        </td>

                        <td>{{ item.itemPrice }} Kč</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="row row-cols-1 row-cols-md-2 g-4 mt-3">
        <div class="col">
            <p>TODO: historie objednávky</p>
        </div>
        <div class="col">
            <p>TODO: historie položek (picking)</p>
        </div>
    </div>
{% endblock %}
